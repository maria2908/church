<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Вход администратора</title>
  <link rel="stylesheet" href="/assets/styles/admin.css">
</head>
<body>
  <h1>Админ-панель</h1>
  <h2>Вход</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Пароль">
  <button id="loginBtn">Войти</button>
  <p id="msg"></p>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const SUPABASE_URL  = 'https://xsxorgfkhmeinjrosprt.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzeG9yZ2ZraG1laW5qcm9zcHJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNjkxMjgsImV4cCI6MjA3MDc0NTEyOH0.ojkysEKiLi5xttq7WyfEnt3xjF4PhIVG1tdxrimjTi8';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

    async function isAdmin(userId) {
      const { data } = await supabase.from('admins')
        .select('user_id').eq('user_id', userId).maybeSingle();
      return !!data;
    }

    // если уже залогинен и он админ — сразу в кабинет
    (async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (user && await isAdmin(user.id)) location.href = '/dashboard.html';
    })();

    document.getElementById('loginBtn').onclick = async () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) { document.getElementById('msg').textContent = error.message; return; }

      if (await isAdmin(data.user.id)) {
        location.href = '/dashboard.html';
      } else {
        document.getElementById('msg').textContent = 'Нет прав администратора';
        await supabase.auth.signOut();
      }
    };
  </script>
</body>
</html>
